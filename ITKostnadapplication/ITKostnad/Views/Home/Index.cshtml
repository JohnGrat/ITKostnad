
@model ITKostnad.Models.ToPageModel
@{
    Layout = null;
}

<!DOCTYPE html>
<link rel="icon" type="image/png" href="~/images/icons/favicon.ico" />
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="~/vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="~/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="~/vendor/animate/animate.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="~/vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="~/vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="~/vendor/select2/select2.min.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="~/vendor/daterangepicker/daterangepicker.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="~/css/util.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="~/css/main.css">
<!--===============================================================================================-->
<link rel="stylesheet" type="text/css" href="~/css/misc.css">

<style>
     .container-contact100 {
        background-image: url('@Url.Content("~/images/bg-01.jpg")');
        background-size: cover; /* <------ */
        background-repeat: no-repeat;
        background-position: center center; /* optional, center the image */
    }

    .contact100-form-title {
        color: #0B4796
    }
</style>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>ITKostnad</title>
</head>
<body>
    <div class="container-contact100">
        <div class="wrap-contact100">
            <form class="contact100-form validate-form" id="itkostnad">
                <span class="contact100-form-title">
                    PARTILLE
                </span>

                <div class="wrap-input100 validate-input" data-validate="Name is required">
                    <span class="label-input100">Datornamn</span>
                    <input class="input100" id="myInput" type="text" name="name" placeholder="ange datornamn" autocomplete="off">
                    <span class="focus-input100"></span>
                </div>

                <div class="wrap-input100 input100-select">
                    <span class="label-input100">Förvaltning</span>
                    <div>
                        <select class="selection-2" name="department" id="department">
                            <option></option>
                            <option>UF</option>
                            <option>KoF</option>
                            <option>SAF</option>
                            <option>SBK</option>
                            <option>KK</option>
                            <option>VOF</option>
                            <option>PBAB</option>
                            <option>KS</option>
                            <option>KF</option>
                        </select>
                    </div>
                    <span class="focus-input100"></span>
                </div>

                <div class="wrap-input100 validate-input" data-validate="Valid email is required: ex@abc.xyz">
                    <span class="label-input100">Plats</span>
                    <input class="input100" type="text" name="location" placeholder="" id="location">
                    <span class="focus-input100"></span>
                </div>

                <div class="wrap-input100 validate-input" data-validate="Valid email is required: ex@abc.xyz">
                    <span class="label-input100">Placering</span>
                    <input class="input100" type="text" name="physicalDeliveryOfficeName" placeholder="" id="physicalDeliveryOfficeName">
                    <span class="focus-input100"></span>
                </div>

                <div class="wrap-input100 validate-input" data-validate="Valid email is required: ex@abc.xyz">
                    <span class="label-input100">Ansvarig</span>
                    <input class="input100" type="text" name="extensionAttribute9" placeholder="" id="extensionAttribute9" autocomplete="off">
                    <span class="focus-input100"></span>
                </div>

                <div class="wrap-input100 input100-select">
                    <span class="label-input100">Personlig/Delad</span>
                    <div>
                        <select class="selection-2" name="extensionAttribute13" id="extensionAttribute13">
                            <option></option>
                            <option>Personlig</option>
                            <option>Delad</option>
                        </select>
                    </div>
                    <span class="focus-input100"></span>
                </div>

                <div class="wrap-input100 validate-input" data-validate="Name is required">
                    <span class="label-input100">Ersätt</span>
                    <input class="input100" id="mySwap" type="text" name="mySwap" placeholder="ange datornamn" autocomplete="off">
                    <span class="focus-input100"></span>
                </div>
                <div id="dropDownSelect1"></div>
                <div class="container-contact100-form-btn">
                    <div class="wrap-contact100-form-btn">
                        <div class="contact100-form-bgbtn"></div>
                        <button button type="button" class="contact100-form-btn disable" id="save" name="save">
                            <span>
                                Spara
                            </span>
                        </button>
                    </div>
                </div>

            </form>

        </div>
    </div>

</body>
</html>


<!--===============================================================================================-->
<script src="~/vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
<script src="~/vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
<script src="~/vendor/bootstrap/js/popper.js"></script>
<!--===============================================================================================-->
<script src="~/vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
<script src="~/vendor/select2/select2.min.js"></script>
<!--===============================================================================================-->
<script src="~/js/misc.js"></script>
<!--===============================================================================================-->
<script src="~/vendor/daterangepicker/moment.min.js"></script>
<!--===============================================================================================-->
<script src="~/vendor/daterangepicker/daterangepicker.js"></script>
<!--===============================================================================================-->
<script src="~/vendor/countdowntime/countdowntime.js"></script>
<!--===============================================================================================-->
<script src="~/js/main.js"></script>



<script>
    var json = JSON.parse('@Html.Raw(Json.Serialize(Model))');

    var computer = json.computer;
    var users = json.user;
    var computerNames = json.computer.map(x => x.name);


    autocompleteComputer(document.getElementById("myInput"), computerNames, 5);
    autocompleteComputer(document.getElementById("mySwap"), computerNames, 3)
    autocompleteUser(document.getElementById("extensionAttribute9"), users, 5)


    $('#myInput').on('focusout', function () {

        if (computerNames.includes(this.value)) {

            var result = {
                "name": this.value
            }
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetComputer", "Home")',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(result),
                dataType: "json",
                success: function (response) {

                    if (response.result == true) {
                        Object.keys(response.data).forEach(element => {
                            if (element != "mySwap") {
                                $("#" + element).val(response.data[element]);
                                $("#" + element).trigger('change');
                            }
                        })
                    } else {
                        alert(response.error);
                    }


                    return

                }
            });
        }
    });

    $('#myInput').on('focusout', function () {

        var mySwap = document.getElementById("mySwap").value;

        if (mySwap != "") {
            $('#save span').text('Ersätt&spara')
        } else {
            $('#save span').text('Spara')
        }

        if (computerNames.includes(this.value) && computerNames.includes(mySwap)) {
            $('#save').removeClass("disable");
            $('#save span').append('<i class="fa fa-long-arrow-right m-l-7"</i>')
        } else if (computerNames.includes(this.value) && (mySwap == "")) {
            $('#save').removeClass("disable");
            $('#save span').append('<i class="fa fa-long-arrow-right m-l-7"</i>')
        } else {
            $('#save').addClass("disable");
        }

        if (!computerNames.includes(this.value)) {
            $('#location').val("");
            $('#physicalDeliveryOfficeName').val("");
            $('#extensionAttribute9').val("");
            $("#department").val("");
            $("#extensionAttribute13").val("");
            $("#department").trigger('change');
            $("#extensionAttribute13").trigger('change');
            $('#save').addClass("disable");
        }

    });

    $('#mySwap').on('focusout', function () {

        var myInput = document.getElementById("myInput").value;

        if (this.value != "") {
            $('#save span').text('Ersätt&spara')
        } else {
            $('#save span').text('Spara')
        }

        if (computerNames.includes(this.value) && computerNames.includes(myInput)) {
            $('#save').removeClass("disable");
            $('#save span').append('<i class="fa fa-long-arrow-right m-l-7"</i>')
        } else if (computerNames.includes(myInput) && (this.value == "")) {
            $('#save').removeClass("disable");
            $('#save span').append('<i class="fa fa-long-arrow-right m-l-7"</i>')
        } else {
            $('#save').addClass("disable");
        }

    });


    $('#save').click(function () {

        var myInput = document.getElementById("myInput").value;
        var mySwap = document.getElementById("mySwap").value;

        if (computerNames.includes(myInput) && computerNames.includes(mySwap)) {
            var computerModel = {};
            var result = {};
            $("#itkostnad").serializeArray().map(function (item) {
                if (computerModel[item.name]) {
                    if (typeof (ComputerModel[item.name]) === "string") {
                        computerModel[item.name] = [config[item.name]];
                    }
                    computerModel[item.name].push(item.value);
                } else {
                    computerModel[item.name] = item.value;
                }
            });
            result["MyInput"] = computerModel;
            result["MySwap"] = mySwap;

            $.ajax({
                type: "POST",
                url: '@Url.Action("SwapComputer", "Home")',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(result),
                dataType: "json",
                success: function (response) {

                    if (response.result == true) {
                        $("#myInput").trigger("focusout")
                        alert("success")
                    } else {
                        alert(response.error);
                    }

                }
            });
        } else if (computerNames.includes(myInput) && mySwap == "") {
            var result = {};
            $("#itkostnad").serializeArray().map(function (item) {
                if (result[item.name]) {
                    if (typeof (result[item.name]) === "string") {
                        result[item.name] = [config[item.name]];
                    }
                    result[item.name].push(item.value);
                } else {
                    result[item.name] = item.value;
                }
            });
            $.ajax({
                type: "POST",
                url: '@Url.Action("SetComputer", "Home")',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(result),
                dataType: "json",
                success: function (response) {
                    if (response.result == true) {
                        alert("success")
                    } else {
                        alert(response.error);
                    }
                }
            });
        }


    });

</script>




